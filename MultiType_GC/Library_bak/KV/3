#include <stdio.h>
#include <stdlib.h>
#include <time.h>
#include <string.h>
#include "btree/pos-btree.h"
#include "alloc_list/alloc_list.h"

#define TEST_OBJ_NAME "ckvstore"

int main(void)
{
	int i, j;
	unsigned long num[2];
	unsigned long key[2];
	Node *head=NULL;
	struct btree_head *bh=NULL;
	void *prime_obj=NULL;
	
	printf("[INIT BTREE1]\n");
//again:
	if(pos_btree_init(TEST_OBJ_NAME) < 0) {
		printf("error of creating object storage!\n");
		//pos_btree_destroy(TEST_OBJ_NAME);
		//goto again;
		return 0;
	}

	printf("[INSERT BTREE NODES]\n");
	srand(time(NULL));
	for(i=0; i<20; i++) {
		for(j=0; j<2; j++) {
			num[i] = rand()%9999999+1000000;
		}
		key[0] = key[1] = rand()%100+1;
		printf("before insert\n");
		if(pos_btree_insert(TEST_OBJ_NAME, (void *)key, (void *)num, 8) < 0) {
			printf("insertion failed!\n");
		}
		printf("insert check[%d]\n", i);
	}

	printf("[MAKE LIST]\n");
	prime_obj = pos_get_prime_object(TEST_OBJ_NAME);
	bh = (struct btree_head *)prime_obj;
	make_list_for_btree(bh, &head);
	printf("[LIST PRINT]\n");
	display(head);
	
	printf("[DISTROY BTREE]\n");
	pos_btree_destroy(TEST_OBJ_NAME);

	printf("[FINISH PROGRAM]\n");

	return 0;
}
